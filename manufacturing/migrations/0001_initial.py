# Generated by Django 5.2.6 on 2025-11-02 06:11

import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('inventory', '0001_initial'),
        ('processes', '0001_initial'),
        ('products', '0001_initial'),
        ('third_party', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Batch',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('batch_id', models.CharField(editable=False, max_length=30, unique=True)),
                ('planned_quantity', models.PositiveIntegerField(help_text='Planned quantity for this batch')),
                ('actual_quantity_started', models.PositiveIntegerField(default=0, help_text='Actual quantity that started production')),
                ('actual_quantity_completed', models.PositiveIntegerField(default=0, help_text='Actual quantity completed successfully')),
                ('scrap_quantity', models.PositiveIntegerField(default=0, help_text='Quantity scrapped during production')),
                ('scrap_rm_weight', models.PositiveIntegerField(default=0, help_text='Raw material weight sent to scrap (in grams)')),
                ('planned_start_date', models.DateTimeField(blank=True, help_text='Planned start date for this batch', null=True)),
                ('planned_end_date', models.DateTimeField(blank=True, help_text='Planned completion date for this batch', null=True)),
                ('actual_start_date', models.DateTimeField(blank=True, help_text='Actual start date', null=True)),
                ('actual_end_date', models.DateTimeField(blank=True, help_text='Actual completion date', null=True)),
                ('status', models.CharField(choices=[('created', 'Created'), ('rm_allocated', 'Raw Material Allocated'), ('in_process', 'In Process'), ('quality_check', 'Quality Check'), ('completed', 'Completed'), ('packed', 'Packed'), ('dispatched', 'Dispatched'), ('cancelled', 'Cancelled'), ('returned_to_rm', 'Returned to RM Store')], default='created', max_length=20)),
                ('progress_percentage', models.DecimalField(decimal_places=2, default=0, help_text='Overall completion percentage', max_digits=5)),
                ('total_processing_time_minutes', models.PositiveIntegerField(default=0, help_text='Total time spent in processing')),
                ('notes', models.TextField(blank=True, help_text='Any special notes or instructions for this batch')),
                ('can_release', models.BooleanField(default=True, help_text='Whether this batch can be released for production. Set to False when MO is stopped.')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assigned_operator', models.ForeignKey(blank=True, help_text='Primary operator assigned to this batch', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_batches', to=settings.AUTH_USER_MODEL)),
                ('assigned_supervisor', models.ForeignKey(blank=True, help_text='Supervisor overseeing this batch', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supervised_batches', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_batches', to=settings.AUTH_USER_MODEL)),
                ('current_process_step', models.ForeignKey(blank=True, help_text='Current process step being executed', null=True, on_delete=django.db.models.deletion.SET_NULL, to='processes.processstep')),
                ('product_code', models.ForeignKey(help_text='Product being manufactured in this batch (should match MO product)', on_delete=django.db.models.deletion.PROTECT, related_name='batches', to='products.product')),
            ],
            options={
                'verbose_name': 'Production Batch',
                'verbose_name_plural': 'Production Batches',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='BatchAllocation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('allocated', 'Allocated'), ('in_transit', 'In Transit'), ('received', 'Received by Process'), ('in_process', 'In Process'), ('completed', 'Completed'), ('returned', 'Returned to RM Store')], default='allocated', max_length=20)),
                ('allocated_at', models.DateTimeField(auto_now_add=True)),
                ('received_at', models.DateTimeField(blank=True, null=True)),
                ('current_location', models.CharField(blank=True, max_length=100)),
                ('location_notes', models.TextField(blank=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('allocated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_batch_allocations', to=settings.AUTH_USER_MODEL)),
                ('allocated_to_operator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='allocated_batches', to=settings.AUTH_USER_MODEL)),
                ('allocated_to_process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='batch_allocations', to='processes.process')),
                ('batch', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='allocations', to='manufacturing.batch')),
                ('heat_numbers', models.ManyToManyField(blank=True, help_text='Heat numbers allocated to this batch', related_name='batch_allocations', to='inventory.heatnumber')),
                ('received_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='received_batch_allocations', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Batch Allocation',
                'verbose_name_plural': 'Batch Allocations',
                'ordering': ['-allocated_at'],
            },
        ),
        migrations.CreateModel(
            name='FinishedGoodsVerification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('pending_verification', 'Pending Verification'), ('quality_check_passed', 'Quality Check Passed'), ('quality_check_failed', 'Quality Check Failed'), ('approved_for_dispatch', 'Approved for Dispatch'), ('dispatched', 'Dispatched')], default='pending_verification', max_length=30)),
                ('quality_checked_at', models.DateTimeField(blank=True, null=True)),
                ('quality_notes', models.TextField(blank=True)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('verification_notes', models.TextField(blank=True)),
                ('dispatched_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('batch', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='fg_verification', to='manufacturing.batch')),
                ('dispatched_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='dispatched_batches', to=settings.AUTH_USER_MODEL)),
                ('quality_checked_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='quality_checked_batches', to=settings.AUTH_USER_MODEL)),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_fg_batches', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Finished Goods Verification',
                'verbose_name_plural': 'Finished Goods Verifications',
            },
        ),
        migrations.CreateModel(
            name='ManufacturingOrder',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('mo_id', models.CharField(editable=False, max_length=20, unique=True)),
                ('date_time', models.DateTimeField(auto_now_add=True)),
                ('quantity', models.PositiveIntegerField(help_text='Quantity to manufacture')),
                ('product_type', models.CharField(blank=True, help_text='Auto-filled: Spring/Stamping Part', max_length=50)),
                ('material_name', models.CharField(blank=True, help_text='Auto-filled from product', max_length=100)),
                ('material_type', models.CharField(blank=True, help_text='Auto-filled: Coil/Sheet', max_length=20)),
                ('grade', models.CharField(blank=True, help_text='Auto-filled material grade', max_length=50)),
                ('wire_diameter_mm', models.DecimalField(blank=True, decimal_places=3, help_text='Auto-filled for coil materials', max_digits=8, null=True)),
                ('thickness_mm', models.DecimalField(blank=True, decimal_places=3, help_text='Auto-filled for sheet materials', max_digits=8, null=True)),
                ('finishing', models.CharField(blank=True, help_text='Material finishing details', max_length=100)),
                ('manufacturer_brand', models.CharField(blank=True, help_text='Material manufacturer', max_length=100)),
                ('weight_kg', models.DecimalField(blank=True, decimal_places=3, max_digits=10, null=True)),
                ('loose_fg_stock', models.PositiveIntegerField(default=0, help_text='Available finished goods stock')),
                ('rm_required_kg', models.DecimalField(decimal_places=3, default=0, help_text='Raw material required in kg', max_digits=10)),
                ('strips_required', models.PositiveIntegerField(blank=True, help_text='Number of strips required for this MO (for press components)', null=True)),
                ('total_pieces_from_strips', models.PositiveIntegerField(blank=True, help_text='Total pieces that will be produced from strips', null=True)),
                ('excess_pieces', models.PositiveIntegerField(blank=True, help_text='Excess pieces due to strip constraints', null=True)),
                ('tolerance_percentage', models.DecimalField(decimal_places=2, default=2.0, help_text='Tolerance percentage for RM loss during process (e.g., 2.00 for Â±2%)', max_digits=5)),
                ('scrap_percentage', models.DecimalField(blank=True, decimal_places=2, help_text='Expected scrap percentage (optional, can be predicted from previous MOs)', max_digits=5, null=True)),
                ('scrap_rm_weight', models.PositiveIntegerField(default=0, help_text='Raw material weight sent to scrap for this MO (in grams)')),
                ('rm_released_kg', models.DecimalField(blank=True, decimal_places=3, help_text='Actual RM released by RM Store Manager (in kg or sheets)', max_digits=10, null=True)),
                ('additional_rm_approved_kg', models.DecimalField(blank=True, decimal_places=3, default=Decimal('0'), help_text='Additional RM approved beyond original allocation (in kg)', max_digits=10, null=True)),
                ('last_additional_rm_approval_at', models.DateTimeField(blank=True, help_text='When additional RM was last approved', null=True)),
                ('rm_completion_status', models.CharField(choices=[('active', 'Active - RM can be released'), ('pending_completion', 'Pending Completion - Waiting for 30min delay'), ('completed', 'Completed - All RM consumed and marked complete')], default='active', help_text='Status of RM allocation/release for this MO', max_length=20)),
                ('shift', models.CharField(blank=True, choices=[('I', '9AM-5PM (Shift I)'), ('II', '5PM-2AM (Shift II)'), ('III', '2AM-9AM (Shift III)')], max_length=10, null=True)),
                ('planned_start_date', models.DateTimeField(blank=True, null=True)),
                ('planned_end_date', models.DateTimeField(blank=True, null=True)),
                ('actual_start_date', models.DateTimeField(blank=True, null=True)),
                ('actual_end_date', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('submitted', 'Submitted'), ('rm_allocated', 'RM Allocated'), ('mo_approved', 'MO Approved'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled'), ('stopped', 'Stopped'), ('rejected', 'Rejected'), ('on_hold', 'On Hold')], default='on_hold', max_length=20)),
                ('priority', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('urgent', 'Urgent')], default='medium', max_length=10)),
                ('priority_level', models.IntegerField(default=0, help_text='Numeric priority level for ordering (higher = more priority). 0=default')),
                ('stopped_at', models.DateTimeField(blank=True, help_text='When this MO was stopped (for resource reallocation)', null=True)),
                ('stop_reason', models.TextField(blank=True, help_text='Reason for stopping this MO')),
                ('customer_name', models.CharField(blank=True, help_text='Customer name (auto-filled from customer)', max_length=200)),
                ('delivery_date', models.DateField(blank=True, null=True)),
                ('special_instructions', models.TextField(blank=True)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('gm_approved_at', models.DateTimeField(blank=True, null=True)),
                ('rm_allocated_at', models.DateTimeField(blank=True, null=True)),
                ('rejected_at', models.DateTimeField(blank=True, null=True)),
                ('rejection_reason', models.TextField(blank=True, help_text='Reason for rejecting this MO')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_mo_orders', to=settings.AUTH_USER_MODEL)),
                ('customer_c_id', models.ForeignKey(blank=True, help_text='Customer for this manufacturing order (references c_id)', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='manufacturing_orders', to='third_party.customer', to_field='c_id')),
                ('gm_approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='gm_approved_mo_orders', to=settings.AUTH_USER_MODEL)),
                ('product_code', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='manufacturing_orders', to='products.product')),
                ('rejected_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rejected_mo_orders', to=settings.AUTH_USER_MODEL)),
                ('rm_allocated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rm_allocated_mo_orders', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Manufacturing Order',
                'verbose_name_plural': 'Manufacturing Orders',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='batch',
            name='mo',
            field=models.ForeignKey(help_text='Parent Manufacturing Order', on_delete=django.db.models.deletion.CASCADE, related_name='batches', to='manufacturing.manufacturingorder'),
        ),
        migrations.CreateModel(
            name='AdditionalRMRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('request_id', models.CharField(editable=False, help_text='Auto-generated: ADD-RM-YYYYMMDD-XXXX', max_length=30, unique=True)),
                ('original_allocated_rm_kg', models.DecimalField(decimal_places=3, help_text='Original RM allocated to MO (kg)', max_digits=10)),
                ('rm_released_so_far_kg', models.DecimalField(decimal_places=3, help_text='RM released to production so far (kg)', max_digits=10)),
                ('additional_rm_requested_kg', models.DecimalField(decimal_places=3, help_text='Additional RM being requested (kg)', max_digits=10)),
                ('reason', models.TextField(help_text="Reason for requesting additional RM (e.g., 'Coil weight variance - last coil was 30kg instead of 10kg')")),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('approved', 'Approved by Manager'), ('rejected', 'Rejected'), ('completed', 'Completed - RM Fully Consumed')], default='pending', max_length=20)),
                ('requested_at', models.DateTimeField(auto_now_add=True, help_text='When the request was created')),
                ('approved_at', models.DateTimeField(blank=True, help_text='When the request was approved', null=True)),
                ('approved_quantity_kg', models.DecimalField(blank=True, decimal_places=3, help_text='Quantity approved by manager (may differ from requested)', max_digits=10, null=True)),
                ('approval_notes', models.TextField(blank=True, help_text="Manager's notes on approval/rejection")),
                ('rejected_at', models.DateTimeField(blank=True, help_text='When the request was rejected', null=True)),
                ('rejection_reason', models.TextField(blank=True, help_text='Reason for rejection')),
                ('marked_complete_at', models.DateTimeField(blank=True, help_text='When the request was marked as complete', null=True)),
                ('completion_notes', models.TextField(blank=True, help_text='Notes on completion')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, help_text='Manager who approved the request', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='additional_rm_requests_approved', to=settings.AUTH_USER_MODEL)),
                ('marked_complete_by', models.ForeignKey(blank=True, help_text='RM Store user who marked this as complete', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='additional_rm_requests_completed', to=settings.AUTH_USER_MODEL)),
                ('rejected_by', models.ForeignKey(blank=True, help_text='Manager who rejected the request', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='additional_rm_requests_rejected', to=settings.AUTH_USER_MODEL)),
                ('requested_by', models.ForeignKey(help_text='RM Store user who created the request', on_delete=django.db.models.deletion.PROTECT, related_name='additional_rm_requests_created', to=settings.AUTH_USER_MODEL)),
                ('excess_batch', models.ForeignKey(blank=True, help_text='Batch that caused RM to exceed allocation', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='additional_rm_requests_caused', to='manufacturing.batch')),
                ('mo', models.ForeignKey(help_text='Manufacturing Order requiring additional RM', on_delete=django.db.models.deletion.CASCADE, related_name='additional_rm_requests', to='manufacturing.manufacturingorder')),
            ],
            options={
                'verbose_name': 'Additional RM Request',
                'verbose_name_plural': 'Additional RM Requests',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='MOApprovalWorkflow',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('pending_manager_approval', 'Pending Manager Approval'), ('manager_approved', 'Manager Approved'), ('manager_rejected', 'Manager Rejected'), ('rm_allocation_pending', 'RM Allocation Pending'), ('rm_allocated', 'RM Allocated'), ('ready_for_production', 'Ready for Production')], default='pending_manager_approval', max_length=30)),
                ('manager_approved_at', models.DateTimeField(blank=True, null=True)),
                ('manager_approval_notes', models.TextField(blank=True)),
                ('rm_store_allocated_at', models.DateTimeField(blank=True, null=True)),
                ('rm_allocation_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('manager_approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_mo_workflows', to=settings.AUTH_USER_MODEL)),
                ('mo', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='approval_workflow', to='manufacturing.manufacturingorder')),
                ('rm_store_allocated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rm_allocated_mo_workflows', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'MO Approval Workflow',
                'verbose_name_plural': 'MO Approval Workflows',
            },
        ),
        migrations.CreateModel(
            name='MOProcessExecution',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('on_hold', 'On Hold'), ('failed', 'Failed'), ('skipped', 'Skipped')], default='pending', max_length=20)),
                ('sequence_order', models.IntegerField(help_text='Order of execution for this MO')),
                ('planned_start_time', models.DateTimeField(blank=True, null=True)),
                ('planned_end_time', models.DateTimeField(blank=True, null=True)),
                ('actual_start_time', models.DateTimeField(blank=True, null=True)),
                ('actual_end_time', models.DateTimeField(blank=True, null=True)),
                ('progress_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assigned_operator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_process_executions', to=settings.AUTH_USER_MODEL)),
                ('assigned_supervisor', models.ForeignKey(blank=True, help_text='Supervisor assigned to this specific process', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supervised_process_executions', to=settings.AUTH_USER_MODEL)),
                ('mo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='process_executions', to='manufacturing.manufacturingorder')),
                ('process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='processes.process')),
            ],
            options={
                'ordering': ['mo', 'sequence_order'],
            },
        ),
        migrations.CreateModel(
            name='MOProcessStepExecution',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('failed', 'Failed'), ('skipped', 'Skipped')], default='pending', max_length=20)),
                ('quality_status', models.CharField(choices=[('pending', 'Pending'), ('passed', 'Passed'), ('failed', 'Failed'), ('rework_required', 'Rework Required')], default='pending', max_length=20)),
                ('actual_start_time', models.DateTimeField(blank=True, null=True)),
                ('actual_end_time', models.DateTimeField(blank=True, null=True)),
                ('quantity_processed', models.PositiveIntegerField(default=0)),
                ('quantity_passed', models.PositiveIntegerField(default=0)),
                ('quantity_failed', models.PositiveIntegerField(default=0)),
                ('scrap_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('operator_notes', models.TextField(blank=True)),
                ('quality_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('operator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='operated_step_executions', to=settings.AUTH_USER_MODEL)),
                ('process_execution', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='step_executions', to='manufacturing.moprocessexecution')),
                ('process_step', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='processes.processstep')),
            ],
            options={
                'ordering': ['process_execution', 'process_step__sequence_order'],
            },
        ),
        migrations.CreateModel(
            name='MOProcessAlert',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('alert_type', models.CharField(choices=[('delay', 'Process Delay'), ('quality_issue', 'Quality Issue'), ('equipment_failure', 'Equipment Failure'), ('material_shortage', 'Material Shortage'), ('operator_issue', 'Operator Issue'), ('custom', 'Custom Alert')], max_length=20)),
                ('severity', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], default='medium', max_length=10)),
                ('title', models.CharField(max_length=200)),
                ('description', models.TextField()),
                ('is_resolved', models.BooleanField(default=False)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('resolution_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_alerts', to=settings.AUTH_USER_MODEL)),
                ('resolved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='resolved_alerts', to=settings.AUTH_USER_MODEL)),
                ('process_execution', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='alerts', to='manufacturing.moprocessexecution')),
                ('step_execution', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='alerts', to='manufacturing.moprocessstepexecution')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='MOStatusHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('from_status', models.CharField(blank=True, max_length=20)),
                ('to_status', models.CharField(max_length=20)),
                ('changed_at', models.DateTimeField(auto_now_add=True)),
                ('notes', models.TextField(blank=True)),
                ('changed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('mo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='status_history', to='manufacturing.manufacturingorder')),
            ],
            options={
                'verbose_name': 'MO Status History',
                'verbose_name_plural': 'MO Status Histories',
                'ordering': ['-changed_at'],
            },
        ),
        migrations.CreateModel(
            name='MOTransactionHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('transaction_type', models.CharField(help_text='Type of transaction (mo_created, rm_allocated, status_changed, etc.)', max_length=50)),
                ('transaction_id', models.CharField(help_text='Unique transaction identifier', max_length=50, unique=True)),
                ('description', models.TextField(help_text='Human-readable description of the transaction')),
                ('details', models.JSONField(default=dict, help_text='Detailed transaction data (stock levels, quantities, etc.)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='mo_transactions', to=settings.AUTH_USER_MODEL)),
                ('mo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transaction_history', to='manufacturing.manufacturingorder')),
            ],
            options={
                'verbose_name': 'MO Transaction History',
                'verbose_name_plural': 'MO Transaction Histories',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='OutsourcingRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('request_id', models.CharField(editable=False, max_length=20, unique=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('date_sent', models.DateField(blank=True, null=True)),
                ('expected_return_date', models.DateField()),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('sent', 'Sent'), ('returned', 'Returned'), ('closed', 'Closed')], default='draft', max_length=20)),
                ('collection_date', models.DateField(blank=True, null=True)),
                ('vendor_contact_person', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('collected_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='collected_outsourcing_requests', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_outsourcing_requests', to=settings.AUTH_USER_MODEL)),
                ('vendor', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='outsourcing_requests', to='third_party.vendor')),
            ],
            options={
                'verbose_name': 'Outsourcing Request',
                'verbose_name_plural': 'Outsourcing Requests',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='OutsourcedItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('mo_number', models.CharField(help_text='Manufacturing Order number', max_length=20)),
                ('product_code', models.CharField(help_text='Product code', max_length=120)),
                ('qty', models.PositiveIntegerField(blank=True, help_text='Quantity in pieces', null=True)),
                ('kg', models.DecimalField(blank=True, decimal_places=3, help_text='Weight in kg', max_digits=10, null=True)),
                ('returned_qty', models.PositiveIntegerField(default=0, help_text='Returned quantity in pieces')),
                ('returned_kg', models.DecimalField(decimal_places=3, default=0, help_text='Returned weight in kg', max_digits=10)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='manufacturing.outsourcingrequest')),
            ],
            options={
                'verbose_name': 'Outsourced Item',
                'verbose_name_plural': 'Outsourced Items',
                'ordering': ['mo_number', 'product_code'],
            },
        ),
        migrations.CreateModel(
            name='ProcessAssignment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('assigned', 'Assigned'), ('accepted', 'Accepted by Operator'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('reassigned', 'Reassigned'), ('cancelled', 'Cancelled')], default='assigned', max_length=20)),
                ('assigned_at', models.DateTimeField(auto_now_add=True)),
                ('accepted_at', models.DateTimeField(blank=True, null=True)),
                ('acceptance_notes', models.TextField(blank=True)),
                ('reassigned_at', models.DateTimeField(blank=True, null=True)),
                ('reassignment_reason', models.TextField(blank=True)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('completion_notes', models.TextField(blank=True)),
                ('assigned_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_process_assignments', to=settings.AUTH_USER_MODEL)),
                ('assigned_operator', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='assigned_processes', to=settings.AUTH_USER_MODEL)),
                ('assigned_supervisor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supervised_process_assignments', to=settings.AUTH_USER_MODEL)),
                ('mo_process_execution', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='process_assignments', to='manufacturing.moprocessexecution')),
                ('previous_operator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='previous_process_assignments', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Process Assignment',
                'verbose_name_plural': 'Process Assignments',
                'ordering': ['-assigned_at'],
            },
        ),
        migrations.CreateModel(
            name='ProcessExecutionLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(choices=[('started', 'Process Started'), ('paused', 'Process Paused'), ('resumed', 'Process Resumed'), ('completed', 'Process Completed'), ('quality_check', 'Quality Check'), ('issue_reported', 'Issue Reported'), ('material_requested', 'Material Requested'), ('tool_change', 'Tool Change'), ('maintenance', 'Maintenance')], max_length=20)),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('duration_minutes', models.PositiveIntegerField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('quantity_processed', models.PositiveIntegerField(blank=True, null=True)),
                ('quality_status', models.CharField(blank=True, max_length=20)),
                ('location', models.CharField(blank=True, max_length=100)),
                ('batch_allocation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='execution_logs', to='manufacturing.batchallocation')),
                ('performed_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='process_execution_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Process Execution Log',
                'verbose_name_plural': 'Process Execution Logs',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='PurchaseOrder',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('po_id', models.CharField(editable=False, max_length=20, unique=True)),
                ('date_time', models.DateTimeField(auto_now_add=True)),
                ('material_type', models.CharField(blank=True, choices=[('coil', 'Coil'), ('sheet', 'Sheet')], max_length=20)),
                ('material_auto', models.CharField(blank=True, help_text='Auto-filled', max_length=100)),
                ('grade_auto', models.CharField(blank=True, help_text='Auto-filled', max_length=50)),
                ('wire_diameter_mm_auto', models.DecimalField(blank=True, decimal_places=3, help_text='Auto-filled for coil', max_digits=8, null=True)),
                ('finishing_auto', models.CharField(blank=True, help_text='Auto-filled finishing', max_length=100, null=True)),
                ('manufacturer_brand_auto', models.CharField(blank=True, help_text='Auto-filled manufacturer', max_length=100, null=True)),
                ('kg_auto', models.DecimalField(blank=True, decimal_places=3, help_text='Auto-filled weight', max_digits=10, null=True)),
                ('thickness_mm_auto', models.DecimalField(blank=True, decimal_places=3, help_text='Auto-filled for sheet', max_digits=8, null=True)),
                ('sheet_roll_auto', models.CharField(blank=True, help_text='Auto-filled sheet/roll info', max_length=50, null=True)),
                ('qty_sheets_auto', models.PositiveIntegerField(blank=True, help_text='Auto-filled number of sheets', null=True)),
                ('vendor_address_auto', models.TextField(blank=True, help_text='Auto-filled from vendor', null=True)),
                ('gst_no_auto', models.CharField(blank=True, help_text='Auto-filled from vendor', max_length=15, null=True)),
                ('mob_no_auto', models.CharField(blank=True, help_text='Auto-filled from vendor', max_length=17, null=True)),
                ('expected_date', models.DateField(help_text='Expected delivery date')),
                ('quantity_ordered', models.DecimalField(decimal_places=2, help_text='Quantity to order (in kg for coil, sheets for sheet material)', max_digits=10)),
                ('quantity_received', models.DecimalField(blank=True, decimal_places=2, help_text='Actual quantity received (set when GRM is created)', max_digits=10, null=True)),
                ('unit_price', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('total_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('status', models.CharField(choices=[('po_initiated', 'Purchase Order Initiated'), ('po_approved', 'Approved by GM'), ('po_cancelled', 'Cancelled by Manager'), ('rm_pending', 'Awaiting RM Store Manager Action'), ('rm_completed', 'Goods Receipt Completed')], default='po_initiated', max_length=20)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('cancelled_at', models.DateTimeField(blank=True, null=True)),
                ('cancellation_reason', models.TextField(blank=True, help_text='Reason for cancellation')),
                ('terms_conditions', models.TextField(blank=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_po_orders', to=settings.AUTH_USER_MODEL)),
                ('cancelled_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='cancelled_po_orders', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_po_orders', to=settings.AUTH_USER_MODEL)),
                ('rm_code', models.ForeignKey(help_text='Select from dropdown - auto fills other details', on_delete=django.db.models.deletion.PROTECT, related_name='purchase_orders', to='inventory.rawmaterial')),
                ('vendor_name', models.ForeignKey(help_text='Only show vendors who have this material', on_delete=django.db.models.deletion.PROTECT, related_name='purchase_orders', to='third_party.vendor')),
            ],
            options={
                'verbose_name': 'Purchase Order',
                'verbose_name_plural': 'Purchase Orders',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='POTransactionHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('transaction_type', models.CharField(help_text='Type of transaction (po_created, po_approved, grm_received, etc.)', max_length=50)),
                ('transaction_id', models.CharField(help_text='Unique transaction identifier', max_length=50, unique=True)),
                ('description', models.TextField(help_text='Human-readable description of the transaction')),
                ('details', models.JSONField(default=dict, help_text='Detailed transaction data (quantities, amounts, etc.)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='po_transactions', to=settings.AUTH_USER_MODEL)),
                ('po', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transaction_history', to='manufacturing.purchaseorder')),
            ],
            options={
                'verbose_name': 'PO Transaction History',
                'verbose_name_plural': 'PO Transaction Histories',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='POStatusHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('from_status', models.CharField(blank=True, max_length=20)),
                ('to_status', models.CharField(max_length=20)),
                ('changed_at', models.DateTimeField(auto_now_add=True)),
                ('notes', models.TextField(blank=True)),
                ('changed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('po', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='status_history', to='manufacturing.purchaseorder')),
            ],
            options={
                'verbose_name': 'PO Status History',
                'verbose_name_plural': 'PO Status Histories',
                'ordering': ['-changed_at'],
            },
        ),
        migrations.CreateModel(
            name='RawMaterialAllocation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('allocated_quantity_kg', models.DecimalField(decimal_places=3, help_text='Quantity of raw material allocated in KG', max_digits=10)),
                ('status', models.CharField(choices=[('reserved', 'Reserved'), ('swapped', 'Swapped to Higher Priority MO'), ('locked', 'Locked (MO Approved)'), ('released', 'Released Back to Stock')], default='reserved', max_length=20)),
                ('can_be_swapped', models.BooleanField(default=True, help_text='Can this allocation be swapped to higher priority MO?')),
                ('swapped_at', models.DateTimeField(blank=True, null=True)),
                ('swap_reason', models.TextField(blank=True)),
                ('locked_at', models.DateTimeField(blank=True, help_text='When this allocation was locked (MO approved)', null=True)),
                ('allocated_at', models.DateTimeField(auto_now_add=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('notes', models.TextField(blank=True)),
                ('allocated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rm_allocations_created', to=settings.AUTH_USER_MODEL)),
                ('locked_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rm_allocations_locked', to=settings.AUTH_USER_MODEL)),
                ('mo', models.ForeignKey(help_text='Manufacturing Order this allocation is for', on_delete=django.db.models.deletion.CASCADE, related_name='rm_allocations', to='manufacturing.manufacturingorder')),
                ('raw_material', models.ForeignKey(help_text='Raw material being allocated', on_delete=django.db.models.deletion.PROTECT, related_name='mo_allocations', to='inventory.rawmaterial')),
                ('swapped_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rm_swaps_performed', to=settings.AUTH_USER_MODEL)),
                ('swapped_to_mo', models.ForeignKey(blank=True, help_text='MO to which this allocation was swapped', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rm_allocations_received', to='manufacturing.manufacturingorder')),
            ],
            options={
                'verbose_name': 'Raw Material Allocation',
                'verbose_name_plural': 'Raw Material Allocations',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='RMAllocationHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(help_text='Action performed (reserved, swapped, locked, released)', max_length=50)),
                ('quantity_kg', models.DecimalField(decimal_places=3, max_digits=10)),
                ('performed_at', models.DateTimeField(auto_now_add=True)),
                ('reason', models.TextField(blank=True)),
                ('allocation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='history', to='manufacturing.rawmaterialallocation')),
                ('from_mo', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rm_allocation_history_from', to='manufacturing.manufacturingorder')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('to_mo', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rm_allocation_history_to', to='manufacturing.manufacturingorder')),
            ],
            options={
                'verbose_name': 'RM Allocation History',
                'verbose_name_plural': 'RM Allocation Histories',
                'ordering': ['-performed_at'],
            },
        ),
        migrations.AddIndex(
            model_name='batch',
            index=models.Index(fields=['mo', 'status'], name='manufacturi_mo_id_0b5851_idx'),
        ),
        migrations.AddIndex(
            model_name='batch',
            index=models.Index(fields=['product_code', 'status'], name='manufacturi_product_269351_idx'),
        ),
        migrations.AddIndex(
            model_name='batch',
            index=models.Index(fields=['batch_id'], name='manufacturi_batch_i_a27c18_idx'),
        ),
        migrations.AddIndex(
            model_name='additionalrmrequest',
            index=models.Index(fields=['mo', 'status'], name='manufacturi_mo_id_d0b44a_idx'),
        ),
        migrations.AddIndex(
            model_name='additionalrmrequest',
            index=models.Index(fields=['status', 'requested_at'], name='manufacturi_status_53a758_idx'),
        ),
        migrations.AddIndex(
            model_name='additionalrmrequest',
            index=models.Index(fields=['approved_at'], name='manufacturi_approve_5a1d62_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='moprocessexecution',
            unique_together={('mo', 'process')},
        ),
        migrations.AlterUniqueTogether(
            name='moprocessstepexecution',
            unique_together={('process_execution', 'process_step')},
        ),
        migrations.AddIndex(
            model_name='motransactionhistory',
            index=models.Index(fields=['mo', 'transaction_type'], name='manufacturi_mo_id_8cf98d_idx'),
        ),
        migrations.AddIndex(
            model_name='motransactionhistory',
            index=models.Index(fields=['created_at'], name='manufacturi_created_5a2461_idx'),
        ),
        migrations.AddIndex(
            model_name='outsourcingrequest',
            index=models.Index(fields=['status'], name='manufacturi_status_98f4de_idx'),
        ),
        migrations.AddIndex(
            model_name='outsourcingrequest',
            index=models.Index(fields=['vendor'], name='manufacturi_vendor__af045a_idx'),
        ),
        migrations.AddIndex(
            model_name='outsourcingrequest',
            index=models.Index(fields=['created_by'], name='manufacturi_created_e9413d_idx'),
        ),
        migrations.AddIndex(
            model_name='outsourcingrequest',
            index=models.Index(fields=['expected_return_date'], name='manufacturi_expecte_748217_idx'),
        ),
        migrations.AddIndex(
            model_name='outsourceditem',
            index=models.Index(fields=['request', 'mo_number'], name='manufacturi_request_332002_idx'),
        ),
        migrations.AddIndex(
            model_name='outsourceditem',
            index=models.Index(fields=['product_code'], name='manufacturi_product_d5c2b9_idx'),
        ),
        migrations.AddIndex(
            model_name='potransactionhistory',
            index=models.Index(fields=['po', 'transaction_type'], name='manufacturi_po_id_d80c7e_idx'),
        ),
        migrations.AddIndex(
            model_name='potransactionhistory',
            index=models.Index(fields=['created_at'], name='manufacturi_created_447094_idx'),
        ),
        migrations.AddIndex(
            model_name='rawmaterialallocation',
            index=models.Index(fields=['mo', 'status'], name='manufacturi_mo_id_214567_idx'),
        ),
        migrations.AddIndex(
            model_name='rawmaterialallocation',
            index=models.Index(fields=['raw_material', 'status'], name='manufacturi_raw_mat_beaf9f_idx'),
        ),
        migrations.AddIndex(
            model_name='rawmaterialallocation',
            index=models.Index(fields=['can_be_swapped'], name='manufacturi_can_be__bf9c9e_idx'),
        ),
    ]
