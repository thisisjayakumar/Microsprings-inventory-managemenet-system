# Generated by Django 5.2.6 on 2025-11-10 05:56

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('manufacturing', '0002_alter_additionalrmrequest_reason_and_more'),
        ('processes', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='BatchProcessCompletion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('completed_at', models.DateTimeField(auto_now_add=True)),
                ('input_quantity_kg', models.DecimalField(decimal_places=2, help_text='Input quantity received for processing (kg)', max_digits=10)),
                ('ok_quantity_kg', models.DecimalField(decimal_places=2, default=0, help_text='OK quantity moving to next process (kg)', max_digits=10)),
                ('scrap_quantity_kg', models.DecimalField(decimal_places=2, default=0, help_text='Scrap quantity (kg)', max_digits=10)),
                ('rework_quantity_kg', models.DecimalField(decimal_places=2, default=0, help_text='Rework quantity staying with supervisor (kg)', max_digits=10)),
                ('is_rework_cycle', models.BooleanField(default=False, help_text='Is this a rework completion?')),
                ('rework_cycle_number', models.PositiveIntegerField(default=0, help_text='Rework cycle count (0 = first time, 1 = first rework, etc.)')),
                ('completion_notes', models.TextField(blank=True)),
                ('defect_description', models.TextField(blank=True, help_text='Description of defects for rework items')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('batch', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='process_completions', to='manufacturing.batch')),
                ('completed_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='batch_completions', to=settings.AUTH_USER_MODEL)),
                ('parent_completion', models.ForeignKey(blank=True, help_text='Original completion that generated this rework', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rework_completions', to='manufacturing.batchprocesscompletion')),
                ('process_execution', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='batch_completions', to='manufacturing.moprocessexecution')),
            ],
            options={
                'ordering': ['-completed_at'],
            },
        ),
        migrations.CreateModel(
            name='BatchReceiptVerification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('received_at', models.DateTimeField(auto_now_add=True)),
                ('action', models.CharField(choices=[('verified', 'Verified - OK'), ('reported', 'Reported - Issue')], max_length=20)),
                ('expected_quantity_kg', models.DecimalField(decimal_places=2, help_text='Expected quantity as per system (kg)', max_digits=10)),
                ('actual_quantity_kg', models.DecimalField(blank=True, decimal_places=2, help_text='Actual quantity received (kg) - required if reported', max_digits=10, null=True)),
                ('report_reason', models.CharField(blank=True, choices=[('low_qty', 'Low Qty Received'), ('high_qty', 'High Qty Received'), ('damaged', 'Damaged / Defective Parts'), ('wrong_product', 'Wrong Product Received'), ('quality_issue', 'Quality Issue'), ('others', 'Others')], max_length=30, null=True)),
                ('report_details', models.TextField(blank=True, help_text='Additional details about the issue')),
                ('is_on_hold', models.BooleanField(default=False, help_text='Whether batch is currently on hold')),
                ('hold_cleared_at', models.DateTimeField(blank=True, null=True)),
                ('clearance_notes', models.TextField(blank=True)),
                ('is_resolved', models.BooleanField(default=False)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('resolution_notes', models.TextField(blank=True)),
                ('notification_sent_to_ph', models.BooleanField(default=False)),
                ('notification_sent_to_prev_supervisor', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('batch', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='receipt_verifications', to='manufacturing.batch')),
                ('hold_cleared_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='batch_holds_cleared', to=settings.AUTH_USER_MODEL)),
                ('previous_process', models.ForeignKey(blank=True, help_text='Process from which batch was received', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='outgoing_batch_receipts', to='processes.process')),
                ('process_execution', models.ForeignKey(help_text='Process where batch is being received', on_delete=django.db.models.deletion.CASCADE, related_name='batch_receipts', to='manufacturing.moprocessexecution')),
                ('received_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='batch_receipts_verified', to=settings.AUTH_USER_MODEL)),
                ('resolved_by', models.ForeignKey(blank=True, help_text='PH or Manager who resolved the issue', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='batch_reports_resolved', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-received_at'],
            },
        ),
        migrations.CreateModel(
            name='BatchReceiptLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('handed_over_at', models.DateTimeField(blank=True, null=True)),
                ('received_at', models.DateTimeField(blank=True, null=True)),
                ('handed_over_quantity_kg', models.DecimalField(decimal_places=2, help_text='Quantity handed over (kg)', max_digits=10)),
                ('received_quantity_kg', models.DecimalField(blank=True, decimal_places=2, help_text='Quantity confirmed received (kg)', max_digits=10, null=True)),
                ('is_verified', models.BooleanField(default=False)),
                ('has_issues', models.BooleanField(default=False)),
                ('transit_duration_minutes', models.PositiveIntegerField(blank=True, help_text='Time between handover and receipt', null=True)),
                ('handover_notes', models.TextField(blank=True)),
                ('receipt_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('batch', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='receipt_logs', to='manufacturing.batch')),
                ('from_process', models.ForeignKey(blank=True, help_text='Source process (null if starting from RM Store)', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='batch_outgoing_logs', to='processes.process')),
                ('handed_over_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='batch_handovers_sent', to=settings.AUTH_USER_MODEL)),
                ('mo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='batch_receipt_logs', to='manufacturing.manufacturingorder')),
                ('received_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='batch_handovers_received', to=settings.AUTH_USER_MODEL)),
                ('to_process', models.ForeignKey(help_text='Destination process', on_delete=django.db.models.deletion.PROTECT, related_name='batch_incoming_logs', to='processes.process')),
                ('verification_record', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='receipt_logs', to='manufacturing.batchreceiptverification')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='BatchTraceabilityEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_type', models.CharField(max_length=50)),
                ('event_description', models.TextField()),
                ('timestamp', models.DateTimeField()),
                ('process_name', models.CharField(blank=True, max_length=100)),
                ('supervisor_name', models.CharField(blank=True, max_length=200)),
                ('ok_kg', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('scrap_kg', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('rework_kg', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('rework_cycle', models.PositiveIntegerField(default=0)),
                ('is_on_hold', models.BooleanField(default=False)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('batch', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='traceability_events', to='manufacturing.batch')),
                ('mo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='traceability_events', to='manufacturing.manufacturingorder')),
            ],
            options={
                'ordering': ['timestamp'],
            },
        ),
        migrations.CreateModel(
            name='FinalInspectionRework',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('inspected_at', models.DateTimeField(auto_now_add=True)),
                ('defect_description', models.TextField()),
                ('rework_quantity_kg', models.DecimalField(decimal_places=2, help_text='Quantity sent for rework (kg)', max_digits=10)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('rework_started_at', models.DateTimeField(blank=True, null=True)),
                ('rework_completed_at', models.DateTimeField(blank=True, null=True)),
                ('reinspected_at', models.DateTimeField(blank=True, null=True)),
                ('reinspection_passed', models.BooleanField(blank=True, null=True)),
                ('reinspection_notes', models.TextField(blank=True)),
                ('rework_cycle_count', models.PositiveIntegerField(default=1, help_text='How many times this batch went through FI rework loop')),
                ('fi_notes', models.TextField(blank=True)),
                ('supervisor_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assigned_to_supervisor', models.ForeignKey(help_text='Supervisor of defective process', on_delete=django.db.models.deletion.PROTECT, related_name='fi_reworks_assigned', to=settings.AUTH_USER_MODEL)),
                ('batch', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='fi_reworks', to='manufacturing.batch')),
                ('defective_process', models.ForeignKey(help_text='Process identified as source of defect', on_delete=django.db.models.deletion.PROTECT, to='processes.process')),
                ('inspected_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='fi_reworks_created', to=settings.AUTH_USER_MODEL)),
                ('mo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='fi_reworks', to='manufacturing.manufacturingorder')),
                ('reinspected_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='fi_reworks_reinspected', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-inspected_at'],
            },
        ),
        migrations.CreateModel(
            name='ProcessActivityLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('activity_type', models.CharField(choices=[('process_started', 'Process Started'), ('process_completed', 'Process Completed'), ('process_stopped', 'Process Stopped'), ('process_resumed', 'Process Resumed'), ('batch_started', 'Batch Started'), ('batch_completed', 'Batch Completed'), ('batch_verified', 'Batch Verified'), ('batch_reported', 'Batch Reported'), ('rework_created', 'Rework Created'), ('rework_started', 'Rework Started'), ('rework_completed', 'Rework Completed'), ('fi_passed', 'FI Passed'), ('fi_rework_assigned', 'FI Rework Assigned'), ('fi_reinspection', 'FI Re-inspection'), ('hold_applied', 'Hold Applied'), ('hold_cleared', 'Hold Cleared'), ('supervisor_assigned', 'Supervisor Assigned'), ('supervisor_changed', 'Supervisor Changed')], max_length=30)),
                ('performed_at', models.DateTimeField(auto_now_add=True)),
                ('ok_quantity_kg', models.DecimalField(blank=True, decimal_places=2, help_text='OK quantity (kg)', max_digits=10, null=True)),
                ('scrap_quantity_kg', models.DecimalField(blank=True, decimal_places=2, help_text='Scrap quantity (kg)', max_digits=10, null=True)),
                ('rework_quantity_kg', models.DecimalField(blank=True, decimal_places=2, help_text='Rework quantity (kg)', max_digits=10, null=True)),
                ('reason', models.TextField(blank=True, help_text='Reason for action (stop reason, report reason, etc.)')),
                ('remarks', models.TextField(blank=True, help_text='Additional remarks or notes')),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional context data in JSON format')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('batch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='activity_logs', to='manufacturing.batch')),
                ('mo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activity_logs', to='manufacturing.manufacturingorder')),
                ('performed_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='process_activities_performed', to=settings.AUTH_USER_MODEL)),
                ('process', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='activity_logs', to='processes.process')),
                ('process_execution', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='activity_logs', to='manufacturing.moprocessexecution')),
            ],
            options={
                'ordering': ['-performed_at'],
            },
        ),
        migrations.CreateModel(
            name='ProcessDowntimeSummary',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField()),
                ('total_stops', models.PositiveIntegerField(default=0)),
                ('total_downtime_minutes', models.PositiveIntegerField(default=0)),
                ('breakdown_machine', models.PositiveIntegerField(default=0)),
                ('breakdown_power', models.PositiveIntegerField(default=0)),
                ('breakdown_maintenance', models.PositiveIntegerField(default=0)),
                ('breakdown_material', models.PositiveIntegerField(default=0)),
                ('breakdown_quality', models.PositiveIntegerField(default=0)),
                ('breakdown_others', models.PositiveIntegerField(default=0)),
                ('last_updated', models.DateTimeField(auto_now=True)),
                ('process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='downtime_summaries', to='processes.process')),
            ],
            options={
                'ordering': ['-date', 'process__name'],
            },
        ),
        migrations.CreateModel(
            name='ProcessStop',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('stop_reason', models.CharField(choices=[('machine_breakdown', 'Machine Breakdown / Repair'), ('power_cut', 'Power Cut'), ('maintenance', 'Maintenance'), ('material_shortage', 'Material Shortage'), ('quality_issue', 'Quality Issue'), ('others', 'Others')], max_length=30)),
                ('stop_reason_detail', models.TextField(blank=True, help_text="Additional details for 'Others' or elaboration on standard reasons")),
                ('stopped_at', models.DateTimeField(auto_now_add=True)),
                ('is_resumed', models.BooleanField(default=False)),
                ('resumed_at', models.DateTimeField(blank=True, null=True)),
                ('resume_notes', models.TextField(blank=True)),
                ('downtime_minutes', models.PositiveIntegerField(default=0, help_text='Calculated downtime in minutes')),
                ('notification_sent_to_ph', models.BooleanField(default=False)),
                ('notification_sent_to_manager', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('batch', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='process_stops', to='manufacturing.batch')),
                ('mo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='process_stops', to='manufacturing.manufacturingorder')),
                ('process_execution', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='process_stops', to='manufacturing.moprocessexecution')),
                ('resumed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='process_stops_resumed', to=settings.AUTH_USER_MODEL)),
                ('stopped_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='process_stops_created', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-stopped_at'],
            },
        ),
        migrations.CreateModel(
            name='ReworkBatch',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('rework_quantity_kg', models.DecimalField(decimal_places=2, help_text='Quantity pending rework (kg)', max_digits=10)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('source', models.CharField(choices=[('process_supervisor', 'Process Supervisor'), ('final_inspection', 'Final Inspection'), ('quality_check', 'Quality Check')], default='process_supervisor', max_length=30)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('rework_cycle_number', models.PositiveIntegerField(help_text='Which rework cycle this is')),
                ('defect_description', models.TextField()),
                ('supervisor_notes', models.TextField(blank=True)),
                ('assigned_supervisor', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='rework_batches_assigned', to=settings.AUTH_USER_MODEL)),
                ('completion_record', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rework_batch_records', to='manufacturing.batchprocesscompletion')),
                ('defect_process', models.ForeignKey(blank=True, help_text='Process that caused the defect (for FI rework)', null=True, on_delete=django.db.models.deletion.PROTECT, to='processes.process')),
                ('original_batch', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rework_batches', to='manufacturing.batch')),
                ('process_execution', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rework_batches', to='manufacturing.moprocessexecution')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddIndex(
            model_name='batchprocesscompletion',
            index=models.Index(fields=['batch', '-completed_at'], name='manufacturi_batch_i_c687ed_idx'),
        ),
        migrations.AddIndex(
            model_name='batchprocesscompletion',
            index=models.Index(fields=['process_execution', '-completed_at'], name='manufacturi_process_f4c0bc_idx'),
        ),
        migrations.AddIndex(
            model_name='batchprocesscompletion',
            index=models.Index(fields=['is_rework_cycle', 'rework_cycle_number'], name='manufacturi_is_rewo_feacc1_idx'),
        ),
        migrations.AddIndex(
            model_name='batchreceiptverification',
            index=models.Index(fields=['batch', 'action'], name='manufacturi_batch_i_541ea1_idx'),
        ),
        migrations.AddIndex(
            model_name='batchreceiptverification',
            index=models.Index(fields=['process_execution', '-received_at'], name='manufacturi_process_3f8508_idx'),
        ),
        migrations.AddIndex(
            model_name='batchreceiptverification',
            index=models.Index(fields=['is_on_hold', 'is_resolved'], name='manufacturi_is_on_h_e695f4_idx'),
        ),
        migrations.AddIndex(
            model_name='batchreceiptlog',
            index=models.Index(fields=['batch', '-created_at'], name='manufacturi_batch_i_8ba297_idx'),
        ),
        migrations.AddIndex(
            model_name='batchreceiptlog',
            index=models.Index(fields=['from_process', 'to_process'], name='manufacturi_from_pr_3298d0_idx'),
        ),
        migrations.AddIndex(
            model_name='batchreceiptlog',
            index=models.Index(fields=['is_verified', 'has_issues'], name='manufacturi_is_veri_4a4305_idx'),
        ),
        migrations.AddIndex(
            model_name='batchtraceabilityevent',
            index=models.Index(fields=['batch', 'timestamp'], name='manufacturi_batch_i_d06946_idx'),
        ),
        migrations.AddIndex(
            model_name='batchtraceabilityevent',
            index=models.Index(fields=['mo', 'timestamp'], name='manufacturi_mo_id_4304d7_idx'),
        ),
        migrations.AddIndex(
            model_name='finalinspectionrework',
            index=models.Index(fields=['batch', 'status'], name='manufacturi_batch_i_0dee8b_idx'),
        ),
        migrations.AddIndex(
            model_name='finalinspectionrework',
            index=models.Index(fields=['defective_process', 'status'], name='manufacturi_defecti_e0c685_idx'),
        ),
        migrations.AddIndex(
            model_name='finalinspectionrework',
            index=models.Index(fields=['assigned_to_supervisor', 'status'], name='manufacturi_assigne_10d1b5_idx'),
        ),
        migrations.AddIndex(
            model_name='processactivitylog',
            index=models.Index(fields=['batch', '-performed_at'], name='manufacturi_batch_i_43d35c_idx'),
        ),
        migrations.AddIndex(
            model_name='processactivitylog',
            index=models.Index(fields=['mo', '-performed_at'], name='manufacturi_mo_id_1f2cea_idx'),
        ),
        migrations.AddIndex(
            model_name='processactivitylog',
            index=models.Index(fields=['process', '-performed_at'], name='manufacturi_process_65e606_idx'),
        ),
        migrations.AddIndex(
            model_name='processactivitylog',
            index=models.Index(fields=['activity_type', '-performed_at'], name='manufacturi_activit_55ac80_idx'),
        ),
        migrations.AddIndex(
            model_name='processactivitylog',
            index=models.Index(fields=['performed_by', '-performed_at'], name='manufacturi_perform_372cc6_idx'),
        ),
        migrations.AddIndex(
            model_name='processdowntimesummary',
            index=models.Index(fields=['date', 'process'], name='manufacturi_date_0991b8_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='processdowntimesummary',
            unique_together={('date', 'process')},
        ),
        migrations.AddIndex(
            model_name='processstop',
            index=models.Index(fields=['batch', 'is_resumed'], name='manufacturi_batch_i_ba3cc3_idx'),
        ),
        migrations.AddIndex(
            model_name='processstop',
            index=models.Index(fields=['mo', 'stopped_at'], name='manufacturi_mo_id_3c98e0_idx'),
        ),
        migrations.AddIndex(
            model_name='processstop',
            index=models.Index(fields=['process_execution', '-stopped_at'], name='manufacturi_process_f0fae3_idx'),
        ),
        migrations.AddIndex(
            model_name='reworkbatch',
            index=models.Index(fields=['original_batch', 'status'], name='manufacturi_origina_f7b56d_idx'),
        ),
        migrations.AddIndex(
            model_name='reworkbatch',
            index=models.Index(fields=['process_execution', 'status'], name='manufacturi_process_d32bf0_idx'),
        ),
        migrations.AddIndex(
            model_name='reworkbatch',
            index=models.Index(fields=['assigned_supervisor', 'status'], name='manufacturi_assigne_01eb7f_idx'),
        ),
    ]
